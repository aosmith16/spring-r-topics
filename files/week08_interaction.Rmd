---
title: "Interactive elements in HTML documents"
output: 
  html_document:
      toc: TRUE
      df_print: "paged"
date: "May 18, 2021"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Use this document to add code and knit to explore options for adding interactive elements to HTML documents.  

Unlike in previous weeks, not all code is present in the document yet. You will be copy-pasting or typing in code to some of the code chunks from the slides. Then knit and explore HTML output document.

You can find today's slides [here](https://aosmith16.github.io/spring-r-topics/slides/week08_interactive_tables.html#1). The slides contain introductory material as well as a list of resources on the various **htmlwidgets** we are going to explore that aren't included here.

## R packages

Be sure to run code chunks in order, starting with loading packages.

Load **palmerpenguins 0.2.2** and **ggplot2 1.0.5** now.

We'll be loading additional packages as we go so we are clear on which package we are using in each section.  

```{r, message = FALSE, warning = FALSE}
library(palmerpenguins) # v. 0.1.0
library(ggplot2) # v. 3.3.3
```

## Penguin dataset

We will work with the Palmer penguin data in the first two sections.

This dataset includes various size measurements for three penguin species on the Palmer Archipelago, as well as `sex` and measurement `year`. See `?penguins` for more information.

Here are the first 5 lines so you have an idea of what this dataset looks like.

```{r}
head(penguins, n = 5)
```

## Using plotly with ggplot2 plots

[Plotly](https://plotly.com/graphing-libraries/) can be used to make a wide variety of interactive charts and maps in Python, R, and JavaScript.  

In R, the **plotly** package is for building stand-alone interactive graphics or for making our static plots interactive. 

We will use `ggplotly()` to add interactive elements to plots we made with **ggplot2**.

Start by loading the package.

```{r, message = FALSE, warning = FALSE}
library(plotly) # v. 4.9.3
```

The first step is to make a standard **ggplot2** plot. We'll make a scatterplot of `bill_length_mm` vs `bill_depth_mm` for each `species` of penguin. The plot is named `g1`.

```{r}
g1 = ggplot(data = penguins, aes(x = bill_depth_mm, 
                                 y = bill_length_mm,
                                 color = species)) +
    geom_point()
```

You are welcome to add code to print this plot if you'd like, but we won't discuss it.

Instead, we'll jump to making the interactive version using `ggplotly()`. The function is wrapped around a plot made with **ggplot2**.

Copy and paste the `ggplotly(g1)` code in the chunk below and then knit to see the output.

```{r plotly1}
# Add ggplotly() code here

```

Take a few minutes to explore the interactive features, such as zooming, panning, selecting, and hovering. 

Click on legend items to focus on one group. 

Double click or click on the "Reset axes" button to reset the plot after you interact with one element.

### Changing the hover text

A **tooltip** is generic term for the text that pops up when hovering over an interactive element. By default, `ggplotly()` includes all plotted data in the tooltip.

We can change this with the `tooltip` argument in `ggplotly()`. 

Let's get just the `y` and `x` values (in that order), leaving the `color` values out of the tooltip.

After adding the code and knitting you will see the tooltip info has changed. 

```{r plotly2}
# Add ggplotly() code here

```

### Linking two plots

You may have noted that you could select or *highlight* points in the scatterplot but then couldn't do anything with them.  

The select tool becomes most useful if including the plot in a larger app, but there are also some built-in tools in **plotly** where selection is useful. This makes use of package **crosstalk** under the hood.

We start by using `highlight_key()` on the dataset we are plotting.

```{r}
peng2 = highlight_key(penguins)
```

Then we'll make two **ggplot2** plots based on this highlighted dataset. The first is the same scatterplot we used before but with the species information and the second is `flipper_length_mm` vs `body_mass_g`.

```{r}
g2 = ggplot(data = peng2, aes(x = bill_depth_mm, 
                              y = bill_length_mm)) +
    geom_point()
```

```{r}
g3 = ggplot(data = peng2, aes(x = body_mass_g, 
                              y = flipper_length_mm)) +
    geom_point()
```

Now we link the plots together using the `subplot()` function and use the `highlight()` function to allow selection across the two no-linked plots. 

```{r plotly3}
# Add plotly() code here

```