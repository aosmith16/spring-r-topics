---
title: 'Interactive elements in HTML documents'
subtitle: '`r anicon::faa("rocket", animate = "spin", anitype = "hover", color = "#F4790B", size = "lg", grow = 15)`'
author: 
  - "<br/><br/><br/>Ariel Muldoon"
date: 'May 18, 2021'
output:
  xaringan::moon_reader:
    css: [xaringan-themer.css, wrap.css]
    nature:
      slideNumberFormat: "%current%"
      highlightStyle: github
      highlightLines: true
      ratio: 16:9
      countIncrementalSlides: true
      beforeInit: "https://platform.twitter.com/widgets.js"
---

```{r setup, include = FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  fig.width=9, fig.height=3.5, fig.retina=3,
  out.width = "100%",
  cache = FALSE,
  echo = TRUE,
  message = FALSE, 
  warning = FALSE,
  fig.show = TRUE,
  hiline = TRUE
)
library(formatR)
library(widgetframe)
```

```{r xaringan-themer, include = FALSE, warning = FALSE}
library(xaringanthemer)
style_duo_accent(
  primary_color = "#1c5253",
  secondary_color = "#F4790B",
  inverse_header_color = "#FFFFFF",
  title_slide_text_color = "#FFFFFF",
  base_font_size = "22px",
  link_color = "#F4790B",
  code_highlight_color = "rgba(244, 121, 11, 0.5)"
)
```

```{r metathis, echo=FALSE}
library(metathis)
meta() %>%
    meta_name("github-repo" = "aosmith16/spring-r-topics") %>% 
    meta_social(
        title = "Interactive elements in HTML documents",
        description = "Adding interactive plots and R objects",
        url = "https://aosmith16.github.io/spring-r-topics/slides/week08_interactive_elements.html",
        image = "https://raw.githubusercontent.com/aosmith16/spring-r-topics/main/slides/week08-share-card.png",
        image_alt = paste(
            "Slides discussing a few packages for adding interactive elements to static HTML documents", 
            "Working sessions class spring 2021"
        ),
        og_type = "website",
        og_author = "Ariel Muldoon",
        twitter_card_type = "summary",
        twitter_creator = "@aosmith16"
    )
```

```{r xaringan-scribble, echo = FALSE}
xaringanExtra::use_scribble()
```

```{r xaringanExtra-clipboard, echo=FALSE}
xaringanExtra::use_clipboard()
```

```{r xaringan-tile-view, echo=FALSE}
xaringanExtra::use_tile_view()
```

```{r broadcast, echo=FALSE}
xaringanExtra::use_broadcast()
```

## Today's Goal

**Practice adding interactive elements to static HTML documents**

Today is like a tasting menu of tools. We will briefly explore  

- **plotly** to add interactivity to plots made with **ggplot2**  
- **DT** to allow for users to interact with a dataset  
- **leaflet** for interactive maps  
- **dygraph** to make interactive plots of time series data  
- Adding interactive elements from packages above to a dashboard made with **flexdashboard**  

--

<br/>
*Before we begin:*

Make sure you saved `week08_interaction.Rmd` from the class website onto your computer. We will be adding code and knitting to HTML within this file.

???

There is so much more you can do with each of these tools that this session will barely scratch the surface

---


## Resources

- [Intro to **htmlwidgets**](https://www.htmlwidgets.org/)   
- [Using **plotly** for interactive plots](https://plotly.com/r/)  
- [Interactive R data objects with **DT**](https://rstudio.github.io/DT/)    
- [Interactive maps with **leaflet**](https://rstudio.github.io/leaflet/)    
- [Charting time series data in R with **dygraphs**](https://rstudio.github.io/dygraphs/)  
- [Interactive dashboards in R with **flexdashboard**](https://rmarkdown.rstudio.com/flexdashboard/)  

.center[
```{r, echo = FALSE, out.width = "25%", fig.alt = "usethis hex logo"}
knitr::include_graphics("figs/week08_files/flexdashboard.png")
```
]

---

class: center, middle, inverse, hide-logo

# <font style="font-family: cursive; font-style:italic">Let's get started!</font>

---

## Running code

- Open the copy of [`week08_interaction.Rmd`](files/week08_interaction.Rmd) that you saved  

- We'll practice different packages based on **htmlwidgets** to add interactive elements.   

- You will mostly be copying code I provide in the slides and then pasting it into code chunks within `week08_interaction.Rmd`. 

- You will knit after each added code example to explore the new interactive element in the HTML output.

---

## R packages 

Load **palmerpenguins 0.2.2** and **ggplot2 1.0.5** now.

We'll be loading additional packages as we go so we are clear on which package we are using in each section.  

```{r, message = FALSE, warning = FALSE}
library(palmerpenguins) # v. 0.1.0
library(ggplot2) # v. 3.3.3
```

---

class: with-logo logo-penguins

## Penguin dataset

We will work with the Palmer penguin data while exploring the first two packages.

This dataset includes various size measurements for three penguin species on the Palmer Archipelago, as well as `sex` and measurement `year`. See `?penguins` for more information.

Here are the first 5 lines.

```{r peng, eval = FALSE}
head(penguins, n = 5)
```

```{r peng-out, echo = FALSE}
knitr::kable(head(penguins, n = 5))
```

---

class: with-logo logo-plotly

## Using plotly with ggplot2 plots

[Plotly](https://plotly.com/graphing-libraries/) can be used to make a wide variety of interactive charts and maps in Python, R, and JavaScript.  

In R, the **plotly** package is for building stand-alone interactive graphics or for making our static plots interactive. `r emo::ji("open_mouth")`  

--

We will use `ggplotly()` to add interactive elements to plots we made with **ggplot2**.

First, load the **plotly** package.

```{r, message = FALSE, warning = FALSE}
library(plotly) # v. 4.9.3
```

---

class: with-logo logo-plotly

## Using plotly with ggplot2 plots

The first step is to make a standard **ggplot2** plot. Here we make a scatterplot of `bill_length_mm` vs `bill_depth_mm` for each `species` of penguin. The plot is named `g1`.

```{r}
g1 = ggplot(data = penguins, aes(x = bill_depth_mm, 
                                 y = bill_length_mm,
                                 color = species)) +
    geom_point()
```

<br/><br/>
You are welcome to add code to print this plot if you'd like but we won't do it here. Instead let's jump to adding interactivity.

---

class: with-logo logo-plotly

## Using plotly with ggplot2 plots

We can use `ggplotly()` to convert a plot made with **ggplot2** into an interactive **plotly** object.  

```{r plotly1, eval = FALSE}
ggplotly(g1)
```

--

<br/><br/>
After adding the code, knit your version of `week08_interaction.Rmd` to see what this looks like in the output.

---

class: with-logo logo-plotly

## Using plotly with ggplot2 plots

.pull-left[
```{r, echo = FALSE}
gp1 = ggplotly(g1)
frameWidget(gp1, width = "95%")
```
]

.pull-right[
Take a few minutes to explore the interactive features, such as zooming, panning, and hovering. 

Click on legend items to focus on one group. 

Double click the plot or click on the "Reset axes" button to reset.
]

???

The selection tool seems to be most useful when you want to make interactive output (like in a shiny app) but you can link two plots together using `highlight_key()`.

---

class: with-logo logo-plotly

### Changing the hover text

A **tooltip** is generic term for the text that pops up when hovering over an interactive element. By default, `ggplotly()` includes all plotted data in the tooltip.

We can change this with the `tooltip` argument in `ggplotly()`. 

Let's get just the `y` and `x` values (in that order), leaving the `color` values out of the tooltip.

```{r, eval = FALSE}
ggplotly(g1, tooltip = c("y", "x"))
```

---

class: with-logo logo-plotly

### Changing the hover text

.pull-left[
```{r, echo = FALSE}
gp2 = ggplotly(g1, tooltip = c("y", "x"))
frameWidget(gp2, width = "80%")
```
]

.pull-right[
After adding the code and knitting you will see the tooltip info has changed. 
]

---

class: with-logo logo-plotly

### Linking two plots

You may have noted that you could select or *highlight* points in the scatterplot but then couldn't do anything with them.  

The select tool becomes most useful if including the plot in a larger app, but there are also some built-in tools in **plotly** where selection is useful. This makes use of package **crosstalk** under the hood.

--

<br/><br/>
We start by using `highlight_key()` on the dataset we are plotting.

```{r}
peng2 = highlight_key(penguins)
```

---

class: with-logo logo-plotly

### Linking two plots

Then we'll make two **ggplot2** plots based on this highlighted dataset. The first is the same scatterplot we used before without the species info and the second is `flipper_length_mm` vs `body_mass_g`.

```{r}
g2 = ggplot(data = peng2, aes(x = bill_depth_mm, 
                              y = bill_length_mm)) +
    geom_point()
```

```{r}
g3 = ggplot(data = peng2, aes(x = body_mass_g, 
                              y = flipper_length_mm)) +
    geom_point()
```

---

class: with-logo logo-plotly

### Linking two plots

Now we link the plots together using the `subplot()` function and use the `highlight()` function to allow selection across the two now-linked plots. 

```{r, eval = FALSE}
g2 %>%
  subplot(g3) %>%
  highlight(on = "plotly_selected",
            off = "plotly_deselect")
```

---

class: with-logo logo-plotly

### Linking two plots

.pull-left[
```{r, echo = FALSE}
gp3 = g2 %>%
  subplot(g3) %>%
  highlight(on = "plotly_selected",
            off = "plotly_deselect")
frameWidget(gp3)
```
]


.pull-right[
When we select in the first, the same points are selected in the second. This allows the user to explore more variables at one time.
]

---

## Interactive data with **DT**

The [**DT** package](https://rstudio.github.io/DT/) allows us to display R data objects such as data.frames as interactive tables of data in HTML outputs.

For example, it provides the user the ability to filter and sort the data in the output table.  

--

Start by loading package **DT**.

```{r, message = FALSE, warning = FALSE}
library(DT) # v. 0.18
```

---

## Interactive data with **DT**

The `datatable()` function creates the interactive output.

Much of the time I think using `datatable()` directly will be sufficient for what we want.

Add the code below and knit to start exploring the default output from `datatable()`.

```{r, eval = FALSE}
datatable(penguins)
```

---
## Interactive data with **DT**

.pull-left[
```{r, echo = FALSE}
dt1 = datatable(penguins,
                extensions = list('FixedColumns',
                                  'Scroller'),
                options = list(
                  deferRender = TRUE,
                  scrollY = 200,
                  scroller = TRUE,
                  fixedColumns = TRUE))
frameWidget(dt1)
```
]


.pull-right[
Take a few minutes and explore the output after knitting.

The results are *paginated*, defaulting to showing 10 rows per page. Click on a page to move through more rows. Change the number of rows showing with the drop-down menu.

You can sort by columns and filter to values using the overall search box.
]

---

### Change table options

There are so many options you can change via the `options` argument that the have their own [own article on the **DT** website](https://rstudio.github.io/DT/options.html).

Here we change the default page length to 5 and the numbers in the drop down menu of page lengths to 5, 7, or 10.

```{r, eval = FALSE}
datatable(penguins,
          options = list(pageLength = 5,
                         lengthMenu = c(5, 7, 10)))
```

---

### Change table options

.pull-left[
```{r, echo = FALSE}
dt3 = datatable(penguins,
                extensions = list('FixedColumns',
                                  'Scroller'),
                options = list(
                  deferRender = TRUE,
                  scrollY = 200,
                  scroller = TRUE,
                  fixedColumns = TRUE,
                  pageLength = 5,
                  lengthMenu = c(5, 7, 10)))
frameWidget(dt3)
```
]


.pull-right[
The table now shows fewer rows.

We also now have only the three options for how many rows to show at one time.
]

---

### Add column filters

We can generate filters for each column in addition to the overall `Search` by adding the `filter` argument. We'll place these at the `top` of the table.

```{r}
datatable(penguins,
          filter = "top",
          options = list(autoWidth = TRUE,
                         columnDefs = list(list(width = '80px', targets = "_all"))))
```


In some cases columns are too narrow for the categorical variable filter boxes. Here I widen them in `options` following [this Stack Overflow post](https://stackoverflow.com/a/31814197/2461552).

???

Other options are none (default) and bottom

---

### Add column filters

.pull-left[
```{r, echo = FALSE}
dt2 = datatable(penguins,
                filter = "top",
                extensions = list('FixedColumns',
                                  'Scroller'),
                options = list(
                  deferRender = TRUE,
                  scrollY = 200,
                  scroller = TRUE,
                  fixedColumns = TRUE,
                  autoWidth = TRUE,
                  columnDefs = list(list(width = '80px', targets = "_all"))) )
frameWidget(dt2)
```
]


.pull-right[
Now you can filter by specific columns. 

Numeric columns get range sliders and character columns get select drop-down menus.
]

---

class: with-logo logo-leaflet

## Interactive maps with **leaflet**


```{r}
library(leaflet) # v. 2.0.4.1
```

```{r, eval = FALSE}
# Oregon climate station data, https://pjbartlein.github.io/GeogDataAnalysis/datasets.html
orstationc = read.csv("https://pjbartlein.github.io/GeogDataAnalysis/data/csv/orstationc.csv")
head(orstationc)

pal = colorQuantile(palette = "YlOrRd", domain = NULL, n = 8)
leaflet(data = orstationc) %>% 
    addTiles() %>%
    addCircleMarkers(color = ~pal(tjul),
                     label = ~tjul,
                     popup = ~Name)



# Corvallis
leaflet() %>% 
    setView(lng = -123.2620, lat = 44.5646, zoom = 12) %>%
    addTiles() %>%
    addAwesomeMarkers(lng = -123.2794, lat = 44.5638, 
                      icon = awesomeIcons(), 
                      popup = "Oregon State University")
```

---